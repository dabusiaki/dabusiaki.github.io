<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monopoly Bank</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        .player { margin: 10px; padding: 10px; border: 1px solid #000; display: inline-block; }
        .balance { font-size: 20px; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Monopoly Bank</h1>
    <input type="text" id="playerName" placeholder="Nazwa gracza">
    <button onclick="addPlayer()">Dołącz</button>
    <h2>Lista graczy</h2>
    <div id="players"></div>
    
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyA04bN5...", // Wstaw swoje dane
            authDomain: "rodzinkataski.firebaseapp.com",
            projectId: "rodzinkataski",
            storageBucket: "rodzinkataski.appspot.com",
            messagingSenderId: "921333004895",
            appId: "1:921333004895:web:b22bdf6d54a32a4838b9ea"
        };
        
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const playersRef = db.collection("players");
        
        function addPlayer() {
            const name = document.getElementById("playerName").value.trim();
            if (name) {
                playersRef.doc(name).set({ balance: 1500 }, { merge: true });
            }
        }
        
        function updateBalance(name, amount) {
            const playerDoc = playersRef.doc(name);
            playerDoc.get().then(doc => {
                if (doc.exists) {
                    playerDoc.update({ balance: doc.data().balance + amount });
                }
            });
        }
        
        function transferMoney(from, to, amount) {
            if (from === to || amount <= 0) return;
            const fromDoc = playersRef.doc(from);
            const toDoc = playersRef.doc(to);
            
            db.runTransaction(transaction => {
                return transaction.get(fromDoc).then(fromSnap => {
                    if (!fromSnap.exists) return;
                    let fromBalance = fromSnap.data().balance;
                    if (fromBalance >= amount) {
                        transaction.update(fromDoc, { balance: fromBalance - amount });
                        return transaction.get(toDoc).then(toSnap => {
                            if (toSnap.exists) {
                                transaction.update(toDoc, { balance: toSnap.data().balance + amount });
                            }
                        });
                    }
                });
            });
        }
        
        function renderPlayers() {
            const playersDiv = document.getElementById("players");
            playersRef.onSnapshot(snapshot => {
                playersDiv.innerHTML = "";
                snapshot.forEach(doc => {
                    const data = doc.data();
                    playersDiv.innerHTML += `
                        <div class="player">
                            <h2>${doc.id}</h2>
                            <p class="balance">$${data.balance}</p>
                            <button onclick="updateBalance('${doc.id}', 100)">+100</button>
                            <button onclick="updateBalance('${doc.id}', -100)">-100</button>
                            <input type="text" id="transferTo-${doc.id}" placeholder="Odbiorca">
                            <input type="number" id="transferAmount-${doc.id}" placeholder="Kwota">
                            <button onclick="transferMoney('${doc.id}', document.getElementById('transferTo-${doc.id}').value, parseInt(document.getElementById('transferAmount-${doc.id}').value))">Przelej</button>
                        </div>
                    `;
                });
            });
        }
        
        renderPlayers();
    </script>
</body>
</html>
